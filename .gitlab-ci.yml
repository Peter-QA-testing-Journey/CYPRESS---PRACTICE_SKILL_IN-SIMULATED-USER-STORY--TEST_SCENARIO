stages:
  - test

test_cypress:
  image: node:20-alpine
  stage: test
  variables:
    DISPLAY: ":99"
    XVFB_ARGS: "-screen 0 1280x1024x24"
  script:  
    - apk update && apk add --no-cache xvfb gtk+3.0 dbus ttf-freefont font-noto msttcorefonts-installer chromium nss freetype harfbuzz ca-certificates bash
    - update-ms-fonts && fc-cache -f
    - time npm ci
    - time npx cypress run --browser chrome